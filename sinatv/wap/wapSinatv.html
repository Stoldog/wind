<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1, user-scalable=no">
		<title>直播</title>
		<link rel="stylesheet" type="text/css" href="css/wapstyle.css"/>
	</head>
	<body>
		<div class="liveBox">
			<video id="video" src="http://mvvideo11.meitudata.com/5acb396c7f4495767.mp4?k=169e9e1b425c471df6ad2911d7ae122c&t=5af7ea1b" autoplay="autoplay"></video>
		</div>
		<div id="exchange">
			<ul class="nav-tabs">
				<li class="selected">交流</li>
				<li>在线</li>
				<li>笔记</li>
			</ul>
			<div class="tab-content">
				<div class="tab-pane active">
					<div id="top-news">
						<div class="left-side">
							<span class="stick-badeg">置顶</span>
						</div>
						<div class="talk-about">置顶文字置顶文字置顶文字置顶文字置顶文字可折行可折行可置顶文字顶文字置顶文字置顶文字可折行可折行可置顶文字置顶文字置顶文字置置顶文字置顶文字置顶文字可折行可折行可置顶文字置顶文字置顶文<span class="fold"><span class="packup">折叠</span><span class="unfold">展开</span></span>
						</div>
					</div>
					<ul class="user-say" style="margin-bottom: 3rem;">
						<li>
							<div class="left-side"><img class="user-buddha" src="img/icon-user.jpg" /></div>
							<div class="talk-about">
								<div class="user-name">DJJJJJ老师<span class="post-date">4月23日 12:30:12</span></div>
								<p class="content">同学们课本提前预习一下。看一下书p3目录。</p>
								<div class="handle">
									<button class="btn">置顶</button>
									<button class="btn del">删除</button>
								</div>
							</div>
						</li>
						<li>
							<div class="left-side"><img class="user-buddha" src="img/icon-user.jpg" /></div>
							<div class="talk-about">
								<div class="user-name font-gray">薛之谦<span class="post-date">4月23日 12:30:12</span></div>
								<p class="content">同学们课本提前预习一下。看一下书p3目录。</p>
								<div class="handle">
									<button class="btn">置顶</button>
									<button class="btn del">删除</button>
								</div>
							</div>
						</li>
						<li>
							<div class="left-side"><img class="user-buddha" src="img/icon-user.jpg" /></div>
							<div class="talk-about">
								<div class="user-name font-gray">薛之谦<span class="post-date">4月23日 12:30:12</span></div>
								<p class="content">同学们课本提前预习一下。</p>
								<div class="handle">
									<button class="btn">置顶</button>
									<button class="btn del">删除</button>
								</div>
							</div>
						</li>
						<li>
							<div class="left-side"><img class="user-buddha" src="img/icon-user.jpg" /></div>
							<div class="talk-about">
								<div class="user-name font-gray">薛之谦<span class="post-date">4月23日 12:30:12</span></div>
								<p class="content">同学们课本提前预习一下。看一下书p3目录。</p>
								<div class="handle">
									<button class="btn">置顶</button>
									<button class="btn del">删除</button>
								</div>
							</div>
						</li>
						<li>
							<div class="left-side"><img class="user-buddha" src="img/icon-user.jpg" /></div>
							<div class="talk-about">
								<div class="user-name font-gray">薛之谦<span class="post-date">4月23日 12:30:12</span></div>
								<p class="content">同学们课本提前预习一下。看一下书p3目录。233333</p>
								<div class="handle">
									<button class="btn">置顶</button>
									<button class="btn del">删除</button>
								</div>
							</div>
						</li>
					</ul>
					<!--<div class="lowest"><span>到底啦!</span></div>-->
					<div class="publish">
						<input class="isay" type="text" value="" placeholder="我也来聊两句" />
						<button class="btn send">发送</button>
					</div>
				</div>
				<div class="tab-pane">
					<ul class="on-line">
						<li>
							<div class="left-side"><img src="img/icon-user.jpg" /></div>
							<div class="userinfo">
								<span class="user-name">DJJJJJ老师</span>
								<span class="date">4月23日 12:30:12</span>
								<div class="handle">
									<button class="silent btn">禁言</button>
								</div>
							</div>
						</li>
						<li>
							<div class="left-side"><img src="img/icon-user.jpg" /></div>
							<div class="userinfo">
								<span class="user-name">张三</span>
								<span class="date">5月23日 12:30:12</span>
								<div class="handle">
									<button class="silent btn">禁言</button>
								</div>
							</div>
						</li>
						<li>
							<div class="left-side"><img src="img/icon-user.jpg" /></div>
							<div class="userinfo">
								<span class="user-name">薛之谦</span>
								<span class="date">5月23日 12:30:12</span>
								<div class="handle">
									<button class="silent btn">禁言</button>
								</div>
							</div>
						</li>
						<li>
							<div class="left-side"><img src="img/icon-user.jpg" /></div>
							<div class="userinfo">
								<span class="user-name font-gray">毛不易</span>
								<span class="date">5月23日 12:30:12</span>
								<div class="handle">
									<button class="silent btn btn-green">解禁</button>
								</div>
							</div>
						</li>
						<li>
							<div class="left-side"><img src="img/icon-user.jpg" /></div>
							<div class="userinfo">
								<span class="user-name font-gray">马冬梅</span>
								<span class="date">5月23日 12:30:12</span>
								<div class="handle">
									<button class="silent btn btn-green">解禁</button>
								</div>
							</div>
						</li>
						<li>
							<div class="left-side"><img src="img/icon-user.jpg" /></div>
							<div class="userinfo">
								<span class="user-name font-gray">周冬雨</span>
								<span class="date">5月23日 12:30:12</span>
								<div class="handle">
									<button class="silent btn btn-green">解禁</button>
								</div>
							</div>
						</li>
						<li>
							<div class="left-side"><img src="img/icon-user.jpg" /></div>
							<div class="userinfo">
								<span class="user-name font-gray">迪丽冷巴</span>
								<span class="date">5月23日 12:30:12</span>
								<div class="handle">
									<button class="silent btn btn-green">解禁</button>
								</div>
							</div>
						</li>
					</ul>
				</div>
				<div class="tab-pane">
					<ul class="user-say" style="margin-bottom: 3rem;">
						<li>
							<div class="left-side icon-anchor">03:22</div>
							<div class="note">
								<div class="">Yes,it is.——一般疑问句的肯定<br/>回答<br/>拓展：单词辅音结尾+元音开头</div>
								<div class="handle"><button class="btn del">删除</button></div>
							</div>
						</li>
						<li>
							<div class="left-side icon-anchor">03:22</div>
							<div class="note">
								<div class="">this 较远较近 this 较远较近</div>
								<div class="handle"><button class="btn del">删除</button></div>
							</div>
						</li>
						<li>
							<div class="left-side icon-anchor">03:22</div>
							<div class="note">
								<div class="">Yes,it is.——一般疑问句的肯定<br/>回答<br/>拓展：单词辅音结尾+元音开头</div>
								<div class="handle"><button class="btn del">删除</button></div>
							</div>
						</li>
					</ul>
					<div class="publish">
						<input class="isay" type="text" value="" placeholder="我也来聊两句" />
						<button class="btn send">发送</button>
					</div>
				</div>
			</div>
		</div>
		<script type="text/javascript" src="js/jquery-2.1.0.js" ></script>
		<script type="text/javascript">
			$(function(){
				//选项卡切换
				var tab = $('.nav-tabs>li');
				tab.click(function(){
					var index = tab.index(this);
					$(this).addClass('selected').siblings().removeClass('selected');
					$('.tab-pane').eq(index).show().siblings().hide();
				});
				//折叠
				$('.fold').click(function(e){
					$('.user-say').height($(window).height()-$('.stick').outerHeight()-210);
					$('.packup, .unfold').toggle();
				});
				//点开操作
				var li = $('.user-say li');
				var handle = $('.user-say .handle');
				li.attr('count', 0);
				$('.user-say').on('click', 'li',function(){
					var t = $(this);
					var index = li.index(this);
					if(t.attr('count') == 0){
						$('.user-say').children().removeClass('bg-gray').attr('count', 0);
						t.addClass('bg-gray').attr('count', 1);
					}else{
						setTimeout(function(){
							t.removeClass('bg-gray').attr('count', 0);
						}, 200);
					}
					$('.user-say').find('.handle').stop().slideUp(200);
					$(this).find('.handle').stop().slideToggle(200);
				});
				//取消面板的默认行为
				$('.user-say').on('click', '.handle',function(e){
					e.stopPropagation();
				});
				$('.isay').click(function(e){
					e.stopPropagation();
				});
				//写交流
				$('.isay').click(function(){
					$('video').css({'width': 0, 'height': 0});
					$(this).parent().css({'top': 0, 'height': 'auto'});
				});
				$('.publish').click(function(){
					$('video').css({'width': '100%', 'height': '100%'});
					$(this).css({'top': 'auto', 'height': '3rem'});
				});
				//禁言和解禁
				$('.silent').click(function(){
					var t = $(this),
						index = $('.silent').index(t);
					if(t.attr('class').indexOf('btn-green') > 0){
						t.removeClass('btn-green').html('禁言');
						$('.userinfo .user-name').eq(index).removeClass('font-gray');
					}else{
						t.addClass('btn-green').html('解禁');
						$('.userinfo .user-name').eq(index).addClass('font-gray');
					}
				});
				//发言按钮
				$('.send').eq(0).click(function(){
					var content = $(this).prev().val(),
						icon = 'img/icon-user.jpg',
						nowTime = new Date().Format("MM月dd日 HH:mm:ss"),
						index = $('.send').eq(0).index(this);
					
					if(content == ''){return false;}
					var li = '<li count="0"><div class="left-side"><img class="user-buddha" src="'+icon+'" /></div><div class="talk-about"><div class="user-name">我<span class="post-date">'+nowTime+'</span></div><p class="content">'+content+'</p><div class="handle"><button class="btn">置顶</button><button class="btn del">删除</button></div></div></li>';
					var tabPane =  $('.tab-pane').eq(0),
						scrollHeight = tabPane.prop('scrollHeight');
					//判断滚动条是否在底部
					if(tabPane.scrollTop()+tabPane.height() == scrollHeight){
						tabPane.eq(0).animate({scrollTop: scrollHeight});
					}
					$('.user-say').eq(0).append(li);
					$(this).prev().val('');
				});
				//做笔记
				$('.send').eq(1).click(function(){
					var curr = Math.floor(document.getElementById('video').currentTime),
						content = $(this).prev().val();
						mcurr = Math.floor(curr/60)<10?'0'+Math.floor(curr/60):Math.floor(curr/60),
						scurr = (curr%60)<10?'0'+(curr%60):curr%60;
					var li = '<li count="0"><div class="left-side icon-anchor">'+mcurr+':'+scurr+'</div><div class="note"><div class="">'+content+'</div><div class="handle"><button class="btn del">删除</button></div></div></li>';
					
					$('.user-say').eq(1).append(li);
					$(this).prev().val('');
				});
				//删除发言
				$('.user-say').on('click', '.del', function(){
					var index = $('.user-say .del').index(this);
					$('.user-say li').eq(index).animate({'margin-left':'-100%'}, 300, function(){
						$(this).slideUp(300, function(){
							$(this).remove();
						});
					});
				});
				
				//获取时间
				Date.prototype.Format = function (fmt) {
				    var o = {
				        "M+": this.getMonth() + 1, //月份
				        "d+": this.getDate(), //日
				        "H+": this.getHours(), //小时
				        "m+": this.getMinutes(), //分
				        "s+": this.getSeconds(), //秒
				        "q+": Math.floor((this.getMonth() + 3) / 3), //季度
				        "S": this.getMilliseconds() //毫秒
				    };
				    if (/(y+)/.test(fmt)) fmt = fmt.replace(RegExp.$1, (this.getFullYear() + "").substr(4 - RegExp.$1.length));    
				    for (var k in o)
				    if (new RegExp("(" + k + ")").test(fmt)) fmt = fmt.replace(RegExp.$1, (RegExp.$1.length == 1) ? (o[k]) : (("00" + o[k]).substr(("" + o[k]).length)));
				    return fmt;
				}
			});
		</script>
	</body>
</html>
